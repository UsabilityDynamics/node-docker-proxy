machine:
  node.version: v0.11.13
  services:
    - docker

dependencies.override:
    - docker pull andypotanin/express:latest
    - docker pull andypotanin/hhvm:latest
    - NODE_ENV=development npm install

test.override:
    - git config --global user.email "andy@udx.io"
    - git config --global user.name "andypotanin"
    - git config --global push.default simple
    - mocha test/unit
    - mocha test/functional
    - mocha test/integration
    - make image; sleep 5
    - make run; sleep 5
    - mocha test/acceptance

deployment:
  hub:
    branch: master
    commands:
      - sed "s/<EMAIL>/$DOCKER_EMAIL/;s/<AUTH>/$DOCKER_AUTH/" < .dockercfg.template > ~/.dockercfg
      - docker push usabilitydynamics/docker-proxy:latest
